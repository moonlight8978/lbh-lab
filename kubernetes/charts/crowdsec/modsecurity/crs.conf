SecRuleEngine On
SecRequestBodyAccess On
# SecRequestBodyLimit 15728640
# SecRequestBodyNoFilesLimit 15728640

# Custom content type go after |application/csp-report|)
SecAction "id:1000, phase:1, pass, t:none, nolog, setvar:'tx.allowed_request_content_type=|application/x-www-form-urlencoded| |multipart/form-data| |text/xml| |application/xml| |application/soap+xml| |application/json| |application/reports+json| |application/csp-report| |text/plain| |application/offset+octet-stream|'"
# Custom method go after OPTIONS
SecAction "id:1001, phase:1, pass, t:none, nolog, setvar:'tx.allowed_methods=GET HEAD POST OPTIONS DELETE PATCH PUT'"

# Allow PromQL
SecRule REQUEST_HEADERS:Host "@pmFromFile lbhlab/sqli-except.data" "id:1010, phase:1, pass, nolog, t:none, ctl:ruleRemoveById=942100"

# Allow SSO path-like scopes
SecRule REQUEST_HEADERS:Host "@pmFromFile lbhlab/sso.data" "id:1020, phase:1, pass, nolog, t:none, chain"
  SecRule ARGS:scope "@rx !^$" "id:1021, phase:2, pass, nolog, t:none, ctl:ruleRemoveById=930120"

SecRule REQUEST_HEADERS:Host "@eq drive.bichls.dev" "id:1030, phase:1, pass, nolog, t:none, ctl:ruleRemoveById=920420, ctl:ruleRemoveById=920230, ctl:ruleRemoveById=911100, ctl:ruleRemoveById=920350, ctl:ruleRemoveById=920340"
