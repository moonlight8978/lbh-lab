---
# yaml-language-server: $schema=https://raw.githubusercontent.com/moonlight8978/lbh-lab/refs/heads/jsonschema/core/service-v1.json

apiVersion: v1
kind: Service
metadata:
  name: traefik-internal
  namespace: traefik-system
  annotations:
    lbipam.cilium.io/ips: 10.242.20.170
spec:
  type: LoadBalancer
  selector:
    app.kubernetes.io/name: traefik
  ports:
    - name: ssh
      port: 22
      targetPort: 8022
    - name: http
      port: 80
      targetPort: 8000
    - name: https
      port: 443
      targetPort: 8443
---
# yaml-language-server: $schema=https://raw.githubusercontent.com/moonlight8978/lbh-lab/refs/heads/jsonschema/gateway.networking.k8s.io/gateway-v1.json
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: traefik-internal
  namespace: traefik-system
  annotations:
    argocd.argoproj.io/sync-wave: "100"
spec:
  gatewayClassName: traefik
  listeners:
    - name: ssh
      protocol: TCP
      port: 8022
      allowedRoutes:
        namespaces:
          from: All
    - name: http
      protocol: HTTP
      port: 8000
      allowedRoutes:
        namespaces:
          from: All
    - name: https
      protocol: HTTPS
      port: 8443
      allowedRoutes:
        namespaces:
          from: All
      tls:
        mode: Terminate
        certificateRefs:
          - group: ""
            kind: Secret
            name: bichls.dev
